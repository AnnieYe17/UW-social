<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Profile - UW Social</title>
  <link rel="stylesheet" href="style.css" />
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="firebase-config.js"></script>
  <script src="user-data.js"></script>
  <script src="navbar.js" defer></script>
</head>
<body>
  <nav-bar></nav-bar>

  <div class="main-content">
    <h1>My Profile</h1>
    <div class="profile-container">
      <div class="profile-header">
        <img id="profile-image" src="images/default-avatar.png" alt="Profile Image">
        <h2 id="profile-nickname">Loading...</h2>
      </div>
      
      <div class="profile-section">
        <h3>My Tags</h3>
        <div id="profile-tags" class="tags-container">
          <!-- Tags will be loaded here -->
        </div>
      </div>

      <div class="profile-section">
        <h3>My Achievements</h3>
        <div id="profile-achievements" class="achievements-container">
          <!-- Achievements will be loaded here -->
        </div>
      </div>

      <div class="profile-section">
        <h3>My Events</h3>
        <div id="profile-events" class="events-container">
          <!-- Events will be loaded here -->
        </div>
      </div>
    </div>
  </div>

  <style>
    .profile-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 30px;
    }

    #profile-image {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
    }

    .profile-section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .profile-section h3 {
      color: #4b2e83;
      margin-bottom: 15px;
    }

    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .tag {
      background: #e8e8e8;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 0.9em;
    }

    .achievements-container, .events-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }
  </style>

  <script>
    // 检查用户登录状态
    firebase.auth().onAuthStateChanged(async (user) => {
      if (user) {
        try {
          const userData = await userDataManager.getUserData(user.uid);
          if (userData) {
            // 更新页面内容
            document.getElementById('profile-nickname').textContent = userData.nickname || 'Set Nickname';
            if (userData.profileImage) {
              document.getElementById('profile-image').src = userData.profileImage;
            }

            // 显示标签
            const tagsContainer = document.getElementById('profile-tags');
            userData.tags.forEach(tag => {
              const tagElement = document.createElement('span');
              tagElement.className = 'tag';
              tagElement.textContent = tag;
              tagsContainer.appendChild(tagElement);
            });

            // 显示成就
            const achievementsContainer = document.getElementById('profile-achievements');
            userData.achievements.forEach(achievement => {
              const achievementElement = document.createElement('div');
              achievementElement.className = 'achievement-card';
              achievementElement.innerHTML = `
                <h4>${achievement.name}</h4>
                <p>${achievement.description}</p>
                <small>Earned: ${new Date(achievement.earnedDate).toLocaleDateString()}</small>
              `;
              achievementsContainer.appendChild(achievementElement);
            });
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
      } else {
        // 用户未登录，重定向到首页
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>